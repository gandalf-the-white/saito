<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="913px" preserveAspectRatio="none" style="width:893px;height:913px;background:#FFFFFF;" version="1.1" viewBox="0 0 893 913" width="893px" zoomAndPan="magnify"><defs/><g><g><title>Lisp client</title><rect fill="#FFFFFF" height="384.3477" style="stroke:#181818;stroke-width:1;" width="10" x="222.0635" y="156.1094"/></g><g><title>MCP server</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="628.2495" y="200.7305"/></g><g><title>MCP server</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="628.2495" y="690.9648"/></g><g><title>Ollama</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="772.8184" y="457.5254"/></g><rect fill="none" height="313.3711" style="stroke:#000000;stroke-width:1.5;" width="689.3579" x="20" y="501.8359"/><rect fill="none" height="252.75" style="stroke:#000000;stroke-width:1.5;" width="589.9629" x="109.395" y="555.457"/><rect fill="none" height="206.4844" style="stroke:#000000;stroke-width:1.5;" width="569.9629" x="119.395" y="594.7227"/><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="750.7188" width="8" x="44.1826" y="81.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="48" x2="48" y1="81.4883" y2="832.207"/></g><g><title>Lisp client</title><rect fill="#000000" fill-opacity="0.00000" height="750.7188" width="8" x="223.0635" y="81.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="226.395" x2="226.395" y1="81.4883" y2="832.207"/></g><g><title>MCP server</title><rect fill="#000000" fill-opacity="0.00000" height="750.7188" width="8" x="629.2495" y="81.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="633.1411" x2="633.1411" y1="81.4883" y2="832.207"/></g><g><title>Ollama</title><rect fill="#000000" fill-opacity="0.00000" height="750.7188" width="8" x="773.8184" y="81.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="777.3579" x2="777.3579" y1="81.4883" y2="832.207"/></g><g class="participant participant-head" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.3652" x="30" y="78.5352">User</text><ellipse cx="48.1826" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M48.1826,21.5 L48.1826,48.5 M35.1826,29.5 L61.1826,29.5 M48.1826,48.5 L35.1826,63.5 M48.1826,48.5 L61.1826,63.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.3652" x="30" y="844.7422">User</text><ellipse cx="48.1826" cy="856.1953" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M48.1826,864.1953 L48.1826,891.1953 M35.1826,872.1953 L61.1826,872.1953 M48.1826,891.1953 L35.1826,906.1953 M48.1826,891.1953 L61.1826,906.1953" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Client"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="195.3369" x="129.395" y="33.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68.8789" x="192.624" y="54.0469">Lisp client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181.3369" x="136.395" y="70.5352">(run-mcp-ollama-session)</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="195.3369" x="129.395" y="831.207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68.8789" x="192.624" y="851.7422">Lisp client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181.3369" x="136.395" y="868.2305">(run-mcp-ollama-session)</text></g><g class="participant participant-head" data-participant="MCP"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="92.2168" x="587.1411" y="33.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.3525" x="595.5732" y="54.0469">MCP server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.2168" x="594.1411" y="70.5352">(*mcp-url*)</text></g><g class="participant participant-tail" data-participant="MCP"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="92.2168" x="587.1411" y="831.207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.3525" x="595.5732" y="851.7422">MCP server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.2168" x="594.1411" y="868.2305">(*mcp-url*)</text></g><g class="participant participant-head" data-participant="Ollama"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="176.9209" x="689.3579" y="33.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.5029" x="754.0669" y="54.0469">Ollama</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162.9209" x="696.3579" y="70.5352">(*ollama-url* /api/chat)</text></g><g class="participant participant-tail" data-participant="Ollama"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="176.9209" x="689.3579" y="831.207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.5029" x="754.0669" y="851.7422">Ollama</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162.9209" x="696.3579" y="868.2305">(*ollama-url* /api/chat)</text></g><g><title>Lisp client</title><rect fill="#FFFFFF" height="384.3477" style="stroke:#181818;stroke-width:1;" width="10" x="222.0635" y="156.1094"/></g><g><title>MCP server</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="628.2495" y="200.7305"/></g><g><title>MCP server</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="628.2495" y="690.9648"/></g><g><title>Ollama</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="772.8184" y="457.5254"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="886.2788" x="0" y="112.1436"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="886.2788" y1="112.1436" y2="112.1436"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="886.2788" y1="115.1436" y2="115.1436"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="102.2832" x="391.9978" y="101.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83.9985" x="397.9978" y="118.0566">Initialisation</text><g class="message" data-participant-1="User" data-participant-2="Client"><polygon fill="#181818" points="210.0635,152.1094,220.0635,156.1094,210.0635,160.1094,214.0635,156.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="48.1826" x2="216.0635" y1="156.1094" y2="156.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.7168" x="55.1826" y="151.3672">user-input</text></g><g class="message" data-participant-1="Client" data-participant-2="MCP"><polygon fill="#181818" points="616.2495,196.7305,626.2495,200.7305,616.2495,204.7305,620.2495,200.7305" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="232.0635" x2="622.2495" y1="200.7305" y2="200.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.1704" x="239.0635" y="180.6777">JSON-RPC \"tools/list\"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354.0024" x="239.0635" y="195.9883">(mcp-tools-list &#8594; mcp-http-request &#8594; http-post-json)</text></g><g class="message" data-participant-1="MCP" data-participant-2="Client"><polygon fill="#181818" points="243.0635,226.041,233.0635,230.041,243.0635,234.041,239.0635,230.041" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="237.0635" x2="632.2495" y1="230.041" y2="230.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.208" x="249.0635" y="225.2988">result.tools</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:1;" x1="232.0635" x2="274.0635" y1="274.6621" y2="274.6621"/><line style="stroke:#181818;stroke-width:1;" x1="274.0635" x2="274.0635" y1="274.6621" y2="287.6621"/><line style="stroke:#181818;stroke-width:1;" x1="233.0635" x2="274.0635" y1="287.6621" y2="287.6621"/><polygon fill="#181818" points="243.0635,283.6621,233.0635,287.6621,243.0635,291.6621,239.0635,287.6621" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.9819" x="239.0635" y="254.6094">mcp-tools-&gt;ollama-tools(tools)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.8491" x="239.0635" y="269.9199">&#8594; ollama-tools</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:1;" x1="232.0635" x2="274.0635" y1="332.2832" y2="332.2832"/><line style="stroke:#181818;stroke-width:1;" x1="274.0635" x2="274.0635" y1="332.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:1;" x1="233.0635" x2="274.0635" y1="345.2832" y2="345.2832"/><polygon fill="#181818" points="243.0635,341.2832,233.0635,345.2832,243.0635,349.2832,239.0635,345.2832" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.8096" x="239.0635" y="312.2305">construire messages</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.5601" x="239.0635" y="327.541">(system + user)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="886.2788" x="0" y="373.9385"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="886.2788" y1="373.9385" y2="373.9385"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="886.2788" y1="376.9385" y2="376.9385"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="132.8979" x="376.6904" y="363.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114.6133" x="382.6904" y="379.8516">Boucle principale</text><g class="message" data-participant-1="Client" data-participant-2="Ollama"><polygon fill="#181818" points="760.8184,453.5254,770.8184,457.5254,760.8184,461.5254,764.8184,457.5254" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="232.0635" x2="766.8184" y1="457.5254" y2="457.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.1416" x="239.0635" y="437.4727">POST /api/chat</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268.8296" x="239.0635" y="452.7832">(call-ollama-with-tools &#8594; http-post-json)</text></g><g class="message" data-participant-1="Ollama" data-participant-2="Client"><polygon fill="#181818" points="243.0635,482.8359,233.0635,486.8359,243.0635,490.8359,239.0635,486.8359" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="237.0635" x2="776.8184" y1="486.8359" y2="486.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.585" x="249.0635" y="482.0938">message + content + tool_calls?</text></g><path d="M20,501.8359 L82.1387,501.8359 L82.1387,509.1465 L72.1387,519.1465 L20,519.1465 L20,501.8359" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="313.3711" style="stroke:#000000;stroke-width:1.5;" width="689.3579" x="20" y="501.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="35" y="515.4043">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="88.897" x="97.1387" y="514.4707">[tool_calls vide]</text><g class="message" data-participant-1="Client" data-participant-2="User"><polygon fill="#181818" points="59.1826,536.457,49.1826,540.457,59.1826,544.457,55.1826,540.457" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="53.1826" x2="226.0635" y1="540.457" y2="540.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.8809" x="65.1826" y="535.7148">content (r&#233;ponse finale)</text></g><path d="M109.395,555.457 L192.4048,555.457 L192.4048,562.7676 L182.4048,572.7676 L109.395,572.7676 L109.395,555.457" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="252.75" style="stroke:#000000;stroke-width:1.5;" width="589.9629" x="109.395" y="555.457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="38.0098" x="124.395" y="569.0254">break</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="109.395" x2="699.3579" y1="573.7676" y2="573.7676"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="108.1416" x="114.395" y="584.4023">[tool_calls pr&#233;sent]</text><path d="M119.395,594.7227 L193.8418,594.7227 L193.8418,602.0332 L183.8418,612.0332 L119.395,612.0332 L119.395,594.7227" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="206.4844" style="stroke:#000000;stroke-width:1.5;" width="569.9629" x="119.395" y="594.7227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="134.395" y="608.291">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="129.5078" x="208.8418" y="607.3574">[pour chaque tool_call]</text><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:1;" x1="227.0635" x2="269.0635" y1="633.3438" y2="633.3438"/><line style="stroke:#181818;stroke-width:1;" x1="269.0635" x2="269.0635" y1="633.3438" y2="646.3438"/><line style="stroke:#181818;stroke-width:1;" x1="228.0635" x2="269.0635" y1="646.3438" y2="646.3438"/><polygon fill="#181818" points="238.0635,642.3438,228.0635,646.3438,238.0635,650.3438,234.0635,646.3438" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234.7998" x="234.0635" y="628.6016">parse-arguments-maybe(arguments)</text></g><g class="message" data-participant-1="Client" data-participant-2="MCP"><polygon fill="#181818" points="616.2495,686.9648,626.2495,690.9648,616.2495,694.9648,620.2495,690.9648" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="227.0635" x2="622.2495" y1="690.9648" y2="690.9648"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.519" x="234.0635" y="670.9121">JSON-RPC \"tools/call\"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="382.186" x="234.0635" y="686.2227">(mcp-call-tool-text &#8594; mcp-http-request &#8594; http-post-json)</text></g><g class="message" data-participant-1="MCP" data-participant-2="Client"><polygon fill="#181818" points="238.0635,716.2754,228.0635,720.2754,238.0635,724.2754,234.0635,720.2754" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="232.0635" x2="632.2495" y1="720.2754" y2="720.2754"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.4658" x="244.0635" y="715.5332">result.content[0].text</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:1;" x1="227.0635" x2="269.0635" y1="780.207" y2="780.207"/><line style="stroke:#181818;stroke-width:1;" x1="269.0635" x2="269.0635" y1="780.207" y2="793.207"/><line style="stroke:#181818;stroke-width:1;" x1="228.0635" x2="269.0635" y1="793.207" y2="793.207"/><polygon fill="#181818" points="238.0635,789.207,228.0635,793.207,238.0635,797.207,234.0635,793.207" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.8774" x="234.0635" y="744.8438">push message 'tool'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.6025" x="234.0635" y="760.1543">(role=tool, tool_name, content)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.8232" x="234.0635" y="775.4648">&#8594; maj de messages</text></g><!--SRC=[bLHBSXCn4DtFARgyiPr4CMjNEHIuM401TYMmmXIbZ9jOGIC9VKno0Gx0AU9p-2QSX9P6yp7O2nQU6lKylNxzkjkyzDh2HuUsCDnwKGh3bOV1M-4Cb5AWyYiria6ngZHCIyahpXmw9xGQ3u0xc2VGuUrtyoKGvHOjNJwBDuELPpMUlXs25uaq0ZDznCA46p4fDzpNjsfGKSncy5e9BxWKZdiI0RDP4UK3kyfIO0g10ame4tp1Io-st6EZinZ2zNvN1hFVsPfWZGwyrhAMbZc8BHOnXJStY_ViUZc7rI219fJOhmOaDvQLGYo6uFVFNn136-yDi_WzO0wcWD7Eitj7fdMAOhgOXFMbMtH1-ij4NApn0DmJr-8x5LVPldGQfUTufQA2_eTZ7ALMpjiWB495hULtwAW-z-WyLd2Ut1mdwr_gK4e4OuMAtQDNSbzgRM2k5NMxRaa1C8GNng24TO1Ah_TFXCmT1EW4r24Ii5pSVEWwJhbBBcKpRJ-4tzJQZze9q7hKfiZ41yRcogWUAjV7s7bg-vUOopsdMpstct4ZSkbxCDYADLAqgu9IfF6RjhGZkzyPSXJXgr3aqJZXU-Hv4cFqrYB_Hcye2TvBOuZ3DQ0Xl7g88vkd5SWZcguEda2f2qO7U_npt_RM4bf3XupRkr1HmB6AFzxYg3sFYt-kdjY9cARTYTIx66SU7_vZB-fS1mDVXqxjI3RyqxFFbp5JHl-zCwUh3sxJJiKm2Xx6lpejSHOF5xM3YbTuqVGsxrF5xsCVcbr9AL2jY_ePVty0]--></g></svg>